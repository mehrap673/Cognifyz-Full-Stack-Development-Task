<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    label .required {
      color: #e74c3c;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #7e22ce;
      box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
    }

    input.invalid {
      border-color: #e74c3c;
    }

    input.valid {
      border-color: #27ae60;
    }

    .error-msg {
      color: #e74c3c;
      font-size: 0.85rem;
      margin-top: 5px;
      display: none;
    }

    .success-msg {
      color: #27ae60;
      font-size: 0.85rem;
      margin-top: 5px;
      display: none;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: normal;
    }

    .radio-group input[type="radio"] {
      width: auto;
    }

    .btn-submit {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-submit:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .btn-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .links {
      text-align: center;
      margin-top: 20px;
    }

    .links a {
      color: #7e22ce;
      text-decoration: none;
      font-weight: 600;
    }

    .password-strength {
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }

    .password-strength-bar {
      height: 100%;
      width: 0;
      transition: all 0.3s;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš€ <%= title %></h1>
      <p>Complete registration with validation</p>
    </div>

    <div class="card">
      <form id="registrationForm" action="/register" method="POST" onsubmit="return validateForm()">
        
        <div class="form-row">
          <div class="form-group">
            <label for="username">Username <span class="required">*</span></label>
            <input 
              type="text" 
              id="username" 
              name="username" 
              placeholder="john_doe123"
              onblur="checkUsername()"
              oninput="validateUsername()"
              required>
            <div class="error-msg" id="usernameError"></div>
            <div class="success-msg" id="usernameSuccess"></div>
          </div>

          <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              placeholder="john@example.com"
              oninput="validateEmail()"
              required>
            <div class="error-msg" id="emailError"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="password">Password <span class="required">*</span></label>
            <input 
              type="password" 
              id="password" 
              name="password" 
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              oninput="validatePassword()"
              required>
            <div class="password-strength">
              <div class="password-strength-bar" id="strengthBar"></div>
            </div>
            <div class="error-msg" id="passwordError"></div>
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
            <input 
              type="password" 
              id="confirmPassword" 
              name="confirmPassword" 
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              oninput="validateConfirmPassword()"
              required>
            <div class="error-msg" id="confirmPasswordError"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">Phone Number <span class="required">*</span></label>
            <input 
              type="tel" 
              id="phone" 
              name="phone" 
              placeholder="9876543210"
              maxlength="10"
              oninput="validatePhone()"
              required>
            <div class="error-msg" id="phoneError"></div>
          </div>

          <div class="form-group">
            <label for="age">Age <span class="required">*</span></label>
            <input 
              type="number" 
              id="age" 
              name="age" 
              placeholder="25"
              min="18"
              max="100"
              oninput="validateAge()"
              required>
            <div class="error-msg" id="ageError"></div>
          </div>
        </div>

        <div class="form-group">
          <label>Gender <span class="required">*</span></label>
          <div class="radio-group">
            <label><input type="radio" name="gender" value="male" required> Male</label>
            <label><input type="radio" name="gender" value="female"> Female</label>
            <label><input type="radio" name="gender" value="other"> Other</label>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="country">Country <span class="required">*</span></label>
            <select id="country" name="country" required>
              <option value="">Select Country</option>
              <option value="India">India</option>
              <option value="USA">USA</option>
              <option value="UK">UK</option>
              <option value="Canada">Canada</option>
              <option value="Australia">Australia</option>
            </select>
          </div>

          <div class="form-group">
            <label for="website">Website (Optional)</label>
            <input 
              type="url" 
              id="website" 
              name="website" 
              placeholder="https://example.com"
              oninput="validateWebsite()">
            <div class="error-msg" id="websiteError"></div>
          </div>
        </div>

        <div class="form-group full-width">
          <label for="bio">Bio (Optional)</label>
          <textarea 
            id="bio" 
            name="bio" 
            rows="3" 
            placeholder="Tell us about yourself..."
            maxlength="200"></textarea>
        </div>

        <div class="form-group checkbox-group">
          <input type="checkbox" id="newsletter" name="newsletter">
          <label for="newsletter">Subscribe to newsletter</label>
        </div>

        <div class="form-group checkbox-group">
          <input type="checkbox" id="terms" name="terms" required>
          <label for="terms">I accept terms and conditions <span class="required">*</span></label>
        </div>

        <button type="submit" class="btn-submit" id="submitBtn">Register Now</button>
      </form>

      <div class="links">
        <a href="/all-users">View All Registered Users â†’</a>
      </div>
    </div>
  </div>

  <script>
    // Inline JavaScript for client-side validation
    
    function validateUsername() {
      const username = document.getElementById('username');
      const error = document.getElementById('usernameError');
      const regex = /^[a-zA-Z0-9_]{3,20}$/;
      
      if (!regex.test(username.value)) {
        username.classList.add('invalid');
        username.classList.remove('valid');
        error.textContent = '3-20 chars, letters/numbers/underscore only';
        error.style.display = 'block';
        return false;
      } else {
        username.classList.remove('invalid');
        username.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    async function checkUsername() {
      const username = document.getElementById('username').value;
      const success = document.getElementById('usernameSuccess');
      const error = document.getElementById('usernameError');
      
      if (!validateUsername()) return;
      
      const res = await fetch('/check-username', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username })
      });
      
      const data = await res.json();
      if (data.available) {
        success.textContent = 'âœ“ Username available';
        success.style.display = 'block';
        error.style.display = 'none';
      } else {
        error.textContent = 'Username already taken';
        error.style.display = 'block';
        success.style.display = 'none';
      }
    }

    function validateEmail() {
      const email = document.getElementById('email');
      const error = document.getElementById('emailError');
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (!regex.test(email.value)) {
        email.classList.add('invalid');
        error.textContent = 'Invalid email format';
        error.style.display = 'block';
        return false;
      } else {
        email.classList.remove('invalid');
        email.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    function validatePassword() {
      const password = document.getElementById('password');
      const error = document.getElementById('passwordError');
      const strengthBar = document.getElementById('strengthBar');
      
      const hasUpper = /[A-Z]/.test(password.value);
      const hasLower = /[a-z]/.test(password.value);
      const hasNumber = /\d/.test(password.value);
      const hasSpecial = /[@$!%*?&]/.test(password.value);
      const isLongEnough = password.value.length >= 8;
      
      let strength = 0;
      if (hasUpper) strength += 20;
      if (hasLower) strength += 20;
      if (hasNumber) strength += 20;
      if (hasSpecial) strength += 20;
      if (isLongEnough) strength += 20;
      
      strengthBar.style.width = strength + '%';
      
      if (strength < 60) {
        strengthBar.style.background = '#e74c3c';
      } else if (strength < 100) {
        strengthBar.style.background = '#f39c12';
      } else {
        strengthBar.style.background = '#27ae60';
      }
      
      if (strength < 100) {
        password.classList.add('invalid');
        error.textContent = 'Password must have 8+ chars, uppercase, lowercase, number, special char';
        error.style.display = 'block';
        return false;
      } else {
        password.classList.remove('invalid');
        password.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    function validateConfirmPassword() {
      const password = document.getElementById('password');
      const confirmPassword = document.getElementById('confirmPassword');
      const error = document.getElementById('confirmPasswordError');
      
      if (password.value !== confirmPassword.value) {
        confirmPassword.classList.add('invalid');
        error.textContent = 'Passwords do not match';
        error.style.display = 'block';
        return false;
      } else {
        confirmPassword.classList.remove('invalid');
        confirmPassword.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    function validatePhone() {
      const phone = document.getElementById('phone');
      const error = document.getElementById('phoneError');
      const regex = /^[6-9]\d{9}$/;
      
      if (!regex.test(phone.value)) {
        phone.classList.add('invalid');
        error.textContent = 'Invalid Indian phone (10 digits, start with 6-9)';
        error.style.display = 'block';
        return false;
      } else {
        phone.classList.remove('invalid');
        phone.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    function validateAge() {
      const age = document.getElementById('age');
      const error = document.getElementById('ageError');
      const ageVal = parseInt(age.value);
      
      if (isNaN(ageVal) || ageVal < 18 || ageVal > 100) {
        age.classList.add('invalid');
        error.textContent = 'Age must be 18-100';
        error.style.display = 'block';
        return false;
      } else {
        age.classList.remove('invalid');
        age.classList.add('valid');
        error.style.display = 'none';
        return true;
      }
    }

    function validateWebsite() {
      const website = document.getElementById('website');
      const error = document.getElementById('websiteError');
      
      if (website.value && !website.value.startsWith('http')) {
        website.classList.add('invalid');
        error.textContent = 'URL must start with http:// or https://';
        error.style.display = 'block';
        return false;
      } else {
        website.classList.remove('invalid');
        error.style.display = 'none';
        return true;
      }
    }

    function validateForm() {
      const isValid = 
        validateUsername() &&
        validateEmail() &&
        validatePassword() &&
        validateConfirmPassword() &&
        validatePhone() &&
        validateAge() &&
        validateWebsite() &&
        document.getElementById('terms').checked;
      
      if (!isValid) {
        alert('Please fix all validation errors before submitting');
      }
      
      return isValid;
    }
  </script>
</body>
</html>
